API Gateway — это компонент архитектуры, который выступает в роли единой точки входа для всех клиентских запросов в систему. Он управляет маршрутизацией, преобразованием, безопасностью и мониторингом API-запросов. Это особенно важно в микросервисных архитектурах, где каждая часть системы может быть отдельным сервисом с собственным API.
### Основные функции API Gateway:
1. **Маршрутизация запросов**:
    - Определяет, какой микросервис должен обработать входящий запрос, и направляет его туда.
    - Может использовать правила маршрутизации, например, по URI или HTTP-методу.
2. **Агрегация ответов**:
    - При запросах к нескольким микросервисам агрегирует их ответы в единый результат.
    - Удобно для случаев, когда клиенту нужен сбор данных из разных сервисов.
3. **Управление безопасностью**:
    - Аутентификация и авторизация (например, проверка JWT-токенов).
    - Шифрование данных.
    - Ограничение числа запросов (rate limiting) и защита от DDoS-атак.
4. **Мониторинг и логирование**:
    - Сбор и анализ метрик, таких как время отклика, число запросов и ошибки.
    - Упрощает отладку и наблюдение за системой.
5. **Преобразование запросов и ответов**:
    - Конвертация форматов данных (например, из XML в JSON и наоборот).
    - Внесение изменений в заголовки HTTP или тело запросов/ответов.
6. **Кэширование**:
    - Ускорение обработки повторяющихся запросов за счёт хранения часто используемых данных.
7. **Load balancing**:
    - Распределение входящих запросов между несколькими экземплярами микросервиса.
### Примеры API Gateway:
- **Open Source**:
    - **Spring Cloud Gateway** — для экосистемы Spring, подходит для реактивных приложений.
    - **Kong** — высокопроизводительный gateway с поддержкой плагинов.
    - **Traefik** — лёгкий, ориентированный на контейнеры и Kubernetes.
    - **Express Gateway** — построен на Node.js.
- **Коммерческие решения**:
    - **AWS API Gateway** — интеграция с другими сервисами AWS.
    - **Azure API Management** — облачное решение от Microsoft.
    - **Google Cloud API Gateway** — ориентирован на GCP.
### Архитектурное значение:
API Gateway играет ключевую роль в разделении обязанностей между клиентом и микросервисами:
- Клиент не взаимодействует напрямую с микросервисами, упрощая клиентский код и снижая зависимость от изменений в системе.
- Гейтвей может уменьшить количество сетевых запросов для клиента за счёт агрегации.
### Когда стоит использовать API Gateway?
- В микросервисной архитектуре, когда множество сервисов предоставляют API.
- Когда необходимо обеспечить единую точку управления для безопасности и мониторинга.
- При наличии потребности в оптимизации клиент-серверного взаимодействия.
### Вызовы при использовании:
1. **Единая точка отказа**: нужно обеспечить высокую доступность.
2. **Увеличение задержек**: гейтвей может добавлять накладные расходы на обработку запросов.
3. **Сложность настройки**: для крупных систем конфигурация маршрутов и плагинов может быть сложной.