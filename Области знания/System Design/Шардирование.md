## Определение
Шардинг (шардирование) - это техника горизонтального разделения данных в базе данных на несколько независимых узлов (шардов), каждый из которых хранит только часть данных. Это применяется для масштабирования нагрузки на систему и улучшения производительности.
![[Pasted image 20250202115102.png]]
## Способы шардирования
1. **Средствами БД.** Некоторые базы - MongoDB, Elasticsearch, ClickHouse и другие - умеют самостоятельно распределять данные между своими экземплярами, для этого достаточно настроить конфигурацию.
2. **Надстройками к БД.** Самый спорный способ - применение надстроек, которые выполняют шардирование, например Vitess или Citus, поскольку при этом есть риск потери данных и производительности.
3. **Клиентскими средствами.** В этом случае экземпляры БД даже не подозревают о существовании друг друга, шардированием управляет сторонне приложение - со всеми вытекающими рисками.
## Когда применяется шардирование?
Шардирование используется, когда:
1. **Объем данных превышает возможности одной машины** (например, большой PostgreSQL или MongoDB уже не справляется).
2. **Система испытывает большие нагрузки на чтение и/или запись** (например, миллионы пользователей одновременно работают с БД).
3. **Отказоустойчивость** — распределение данных по разным узлам уменьшает риск потери всех данных при сбое.
4. **Требуется географическая локализация данных** — пользователи из разных регионов могут работать с ближайшим шардинг-сервером.
## Виды шардинга
1. На основе диапозоных значений (по времени, номеру записи)
2. Хеш-шардирование, по модулинг хеш значения от какого то ключа
3. Географическое шардирование
4. Шардирование по типу данных
## Проблемы шардирования
1. **Сложные запросы** (например, `JOIN` между разными шардами становится проблемой).
2. **Перебалансировка** (при добавлении новых шардов данные нужно перераспределять).
3. **Консистентность данных** (не все системы поддерживают транзакции между шардами).
4. **Поддержка глобальных индексов** (нужно отдельно проектировать).
## Когда надо шардить:
- 1-2 ТБ
- 
